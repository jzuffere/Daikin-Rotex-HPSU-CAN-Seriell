template:
  - sensor:
    - default_entity_id: sensor.cop_wert
      name: COP Wert
      state: >-
        {% set thermische_leistung = states('sensor.rotex_thermische_leistung') | float(0) %}
        {% set stromverbrauch = states('sensor.wp_channel_a_power') | float(0) / 1000 %}
        {% set kompressor_status = states('binary_sensor.rotex_status_kompressor') %}
        {% if kompressor_status == 'An' and stromverbrauch > 0 %}
          {% if thermische_leistung >= 0 %}
            {{ (thermische_leistung / stromverbrauch) | round(2) }}
          {% else %}
            {{ (-1 * thermische_leistung / stromverbrauch) | round(2) }}
          {% endif %}
        {% else %}
          0
        {% endif %}
